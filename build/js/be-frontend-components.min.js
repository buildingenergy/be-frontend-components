!function(i){i.module("scrollAffix",[]).directive("scrollAffix",function(){return{restrict:"A",scope:{scrollAffixHeight:"@?",scrollAffixDebug:"@?"},link:function(e,n,t){var o=i.element(window);e.scrollAffixHeight=e.scrollAffixHeight||147,e.scrollAffixHeight=+e.scrollAffixHeight,o.on("scroll",function(t){var o;o=i.element(window).scrollTop(),e.scrollAffixDebug&&console.log({scrollTop:o}),o>e.scrollAffixHeight?n.addClass("fixie"):n.removeClass("fixie")}),e.$on("$destroy",function(){o.off("scroll")})}}})}(window.angular),angular.module("tel",[]).filter("tel",function(){return function(i){if(!i)return"";var e=i.toString().trim().replace(/^\+/,"");if(e.match(/[^0-9]/))return i;var n,t,o;switch(e.length){case 10:n=1,t=e.slice(0,3),o=e.slice(3);break;case 11:n=e[0],t=e.slice(1,4),o=e.slice(4);break;case 12:n=e.slice(0,3),t=e.slice(3,5),o=e.slice(5);break;default:return i}return 1===n&&(n=""),o=o.slice(0,3)+"-"+o.slice(3),(n+" ("+t+") "+o).trim()}}),function(i){i.module("BE.frontend.buildingMap",[])}(angular),function(i){var e=function(i){return'         <div class="map_pop_up_container bottom center">           <div class="arrow"></div>           <div class="map_pop_up_inner">               '+i+"           </div>         </div>"};i.module("BE.frontend.buildingMap").controller("BuildingMapController",["$scope","geo_service",function(i,n){var t=function(){};i.config=i.getConfig()||{};var o=i.config=_.defaults(i.config,{markerIconActive:i.config.markerIcon,onSiteClick:function(i){},onSiteMouseOver:function(i){},onSiteMouseOut:function(i){},popupHTML:function(i){return""+i.address_line_1},onViewportChange:t,onBuildingChange:t,loadAPI:{}}),r=[],a={},u={};i.sites={};var l=function(i,e){a[e.id]=i,_.assign(u[e.id],e),n.cache_building(e)},s=function(e){var n=e.building_snapshot_id;return i.sites[n]||(i.sites[n]=e),i.sites[n]};i.getSite=function(e){return i.sites[e.id]},i.getBuilding=function(e){return i.buildings[a[e.building_snapshot_id]]},i.createMap=function(e){var n,t={minZoom:3};return"mapquest-osm"==i.tileset?(n=L.map(e,t),n.addLayer(L.tileLayer("https://otile{s}-s.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpeg",{attribution:'Tiles by <a href="http://www.mapquest.com/">MapQuest</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',subdomains:"1234",maxZoom:18}))):"mapbox"==i.tileset?(L.mapbox?L.mapbox.accessToken||console.error("Must supply L.mapbox.accessToken"):console.error("No mapbox.js found!"),n=L.mapbox.map(e,i.mapboxId),defaultMarkerIcon=L.mapbox.marker.icon({"marker-size":"small","marker-color":"#AA60D6"})):console.error("Unknown map tileset: "+i.tileset),n},i.withDynamicBuilding=function(e,t){var o=i.getBuilding(e);if(o)t(o,!0);else{var r=n.get_building_snapshot(e.canonical_building_id);r.then(function(i){var n=i.cached;u[e.building_snapshot_id]?n=!0:(u[e.building_snapshot_id]=i.building,d(i.building,e)),t(u[e.building_snapshot_id],n)})}};var c=function(){for(var e in i.buildings){var n=i.buildings[e];u[n.id]&&(i.buildings[e]=u[n.id])}};i.sitePopupIsOpen=function(e){return i.map.hasLayer(e.marker.getPopup())};var g=function(){B()},d=function(i,e){},p=function(e){var n=e.target.site;i.withDynamicBuilding(n,function(e){o.onSiteClick(e,n),i.updateBuildingHighlight(e),k(e,n)})},f=function(e){var n=e.target.site;i.withDynamicBuilding(n,function(e){o.onSiteMouseOver(e,n),i.updateBuildingHighlight(e),k(e,n)})},m=function(e){var n=e.target.site;i.withDynamicBuilding(n,function(e){o.onSiteMouseOut(e,n),i.updateBuildingHighlight(e),k(e,n)})},h=function(e){if(e.latlng={lat:parseFloat(e.latitude),lng:parseFloat(e.longitude)},!e.marker){var n=L.marker(e.latlng,{icon:o.markerIcon});n.site=e,e.marker=n,e.marker.on("click",p),e.marker.on("mouseover",f),e.marker.on("mouseout",m)}return i.siteLayer.hasLayer(e.marker)||i.siteLayer.addLayer(e.marker),e},v=function(i,n){var t=L.popup({autoPan:!1,minWidth:400,maxWidth:400,closeButton:!1}).setContent(e(o.popupHTML(i)));t.site=n,t.marker=n.marker,n.marker.bindPopup(t,{openOnClick:!1})},b=function(){r.forEach(function(i){i()}),r=[]},k=_.debounce(function(e){i.$apply(function(){y(e)})},100),y=function(e,n){n||(n=i.getSite(e)),o.onBuildingChange(e,n)},B=function(){b();for(var e in i.buildings)if(building=i.buildings[e],site=i.getSite(building),site){var n=i.$watch("buildings["+e+"]",y,!0);r.push(n)}};i.$watch("buildings",function(){i.updateBuildings()});var x=function(e,n){i.withDynamicBuilding(e,function(i){e.marker.getPopup()||v(i,e);var t=e.marker.openPopup();"function"==typeof n&&n(t)})},w=function(){i.map.closePopup()},C=function(e){i.sitePopupIsOpen(e)?w():x(e)};i.updateBuildingHighlight=function(e){site=i.getSite(e);var n=o.buildingHighlight(e,site);site&&site.marker&&site.marker._map&&(n?(site.marker.setIcon(o.markerIconActive),site.marker.setZIndexOffset(250),site._highlighted=!0):(site.marker.setIcon(o.markerIcon),site.marker.setZIndexOffset(0),site._highlighted=!1))},i.updateAllBuildingsHighlight=function(e){for(var n in i.buildings)e=i.buildings[n],i.updateBuildingHighlight(e)},i.pruneMarkers=function(){var e=i.siteLayer.getLayers();for(var n in e){var t=e[n];t.site||i.siteLayer.removeLayer(t)}},i.updateBuildings=function(){var e,n,t,o,r=i.getSites(),a={};c();for(e in r)a[r[e].building_snapshot_id]=r[e];for(e in i.buildings)n=i.buildings[e],l(e,n);for(e in r)o=r[e],o.latitude&&(t=s(o),h(t));for(var u in i.sites)a[u]||i.siteLayer.removeLayer(i.sites[u].marker);for(e in i.buildings)n=i.buildings[e],t=i.getSite(n),t&&d(n,t);g()},o.loadAPI({openPopup:x,closePopup:w,togglePopup:C,getBuilding:i.getBuilding,getSite:i.getSite,sitePopupIsOpen:i.sitePopupIsOpen,updateBuilding:y,updateBuildings:i.updateBuildings,updateBuildingHighlight:i.updateBuildingHighlight,updateAllBuildingsHighlight:i.updateAllBuildingsHighlight,withDynamicBuilding:i.withDynamicBuilding,centerOnMap:function(e,n){i.siteLayer.zoomToShowLayer(e.marker,n)},pruneMarkers:i.pruneMarkers})}])}(angular),function(i){var e=function(i,e){var n,t,o=i.getSize();return n=e.x<=o.x/3?"left":e.x<=2*o.x/3?"center":"right",t=e.y<=o.y/2?"top":"bottom",n+" "+t},n=function(i,n){var t=i.latLngToContainerPoint(n.marker.getLatLng());$(n._container).removeClass("top bottom left right center").addClass(e(i,t)+" has_value")};i.module("BE.frontend.buildingMap").directive("buildingMap",[function(){return{restrict:"A",scope:{buildings:"=buildings",getSites:"&buildingSites",getConfig:"&config",tileset:"@",initialCenter:"&",initialZoom:"&"},controller:"BuildingMapController",link:function(i,e,t){var o=i.config,r=i.createMap(e[0]),a=_.debounce(function(i,e){if(e.getLayers().length>0){var n=e.getBounds();i.fitBounds(n,{padding:[20,20]})}else i.setView([40,-95],4)},300);i.map=r,i.siteLayer=new L.MarkerClusterGroup({spiderfyDistanceMultiplier:2,maxClusterRadius:function(i){return 15>=i?60:16>=i?20:2}}),r.addLayer(i.siteLayer),i.controlLayer=L.control.layers([],{Buildings:i.siteLayer}).addTo(r),r.on("load",function(e){a(r,i.siteLayer),r.on("zoomend dragend resize",_.debounce(function(i){o.onViewportChange(r)},100)),o.initialize&&o.initialize(r,i.controlLayer)}),r.on("popupopen",function(i){n(r,i.popup),$(i.popup._container).find(".close_it").one("click",function(i){r.closePopup()}),i.popup.site.popupIsOpen=!0}),r.on("popupclose",function(i){i.popup.site.popupIsOpen=!1}),i.initialCenter()&&i.initialZoom()?r.setView(i.initialCenter(),i.initialZoom()):a(r,i.siteLayer);var u=function(i){return i._leaflet_id},l=function(){var e=i.map.getZoom(),n=[],t=i.siteLayer.getLayers();for(var o in t){var r=t[o],a=r.site;a._highlighted&&n.push(r.__parent)}n=_.uniq(n,u);for(var l in n)for(var s=n[l];s.__parent&&s._zoom>=e;)s._icon&&$(s._icon).addClass("marker-cluster-highlighted"),s=s.__parent};i.siteLayer.on("animationend",function(e){l(),i.updateAllBuildingsHighlight()})}}}])}(angular);
//# sourceMappingURL=be-frontend-components.min.js.map