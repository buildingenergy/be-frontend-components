!function(i){i.module("scrollAffix",[]).directive("scrollAffix",function(){return{restrict:"A",scope:{scrollAffixHeight:"@?",scrollAffixDebug:"@?"},link:function(e,n){var t=i.element(window);e.scrollAffixHeight=e.scrollAffixHeight||147,e.scrollAffixHeight=+e.scrollAffixHeight,t.on("scroll",function(){var t;t=i.element(window).scrollTop(),e.scrollAffixDebug&&console.log({scrollTop:t}),t>e.scrollAffixHeight?n.addClass("fixie"):n.removeClass("fixie")}),e.$on("$destroy",function(){t.off("scroll")})}}})}(window.angular),angular.module("tel",[]).filter("tel",function(){return function(i){if(!i)return"";var e=i.toString().trim().replace(/^\+/,"");if(e.match(/[^0-9]/))return i;var n,t,o;switch(e.length){case 10:n=1,t=e.slice(0,3),o=e.slice(3);break;case 11:n=e[0],t=e.slice(1,4),o=e.slice(4);break;case 12:n=e.slice(0,3),t=e.slice(3,5),o=e.slice(5);break;default:return i}return 1===n&&(n=""),o=o.slice(0,3)+"-"+o.slice(3),(n+" ("+t+") "+o).trim()}}),function(i){i.module("BE.frontend.buildingMap",[])}(angular),function(i){var e=function(i){return'         <div class="map_pop_up_container bottom center">           <div class="arrow"></div>           <div class="map_pop_up_inner">               '+i+"           </div>         </div>"};i.module("BE.frontend.buildingMap").controller("BuildingMapController",["$scope","geo_service",function(n,t){var o=function(){};n.config=n.getConfig()||{};var r=n.config=_.defaults(n.config,{markerIconActive:n.config.markerIcon,onSiteClick:function(){},onSiteMouseOver:function(){},onSiteMouseOut:function(){},popupHTML:function(i){return""+i.address_line_1},onViewportChange:o,onBuildingChange:o,loadAPI:{}}),a=[],u={},l={};n.sites={};var s=function(i,e){u[e.id]=i,_.assign(l[e.id],e),t.cache_building(e)},c=function(i){var e=i.building_snapshot_id;return n.sites[e]||(n.sites[e]=i),n.sites[e]};n.getSite=function(i){return n.sites[i.id]},n.getBuilding=function(i){return n.buildings[u[i.building_snapshot_id]]},n.createMap=function(e){var t,o,r={minZoom:3,zoom:12};return"mapquest-osm"===n.tileset?(o=i.copy(r),MQ&&MQ.mapLayer||console.error("MapQuest layer missing! Make sure the MapQuest Maps plugin for Leaflet with AppKey is present. https://developer.mapquest.com/documentation/leaflet-plugins/maps"),o.layers=MQ.mapLayer(),t=L.map(e,o)):"mapbox"==n.tileset?(L.mapbox?L.mapbox.accessToken||console.error("Must supply L.mapbox.accessToken"):console.error("No mapbox.js found!"),t=L.mapbox.map(e,n.mapboxId),defaultMarkerIcon=L.mapbox.marker.icon({"marker-size":"small","marker-color":"#AA60D6"})):console.error("Unknown map tileset: "+n.tileset),t},n.withDynamicBuilding=function(i,e){var o=n.getBuilding(i);if(o)e(o,!0);else{var r=t.get_building_snapshot(i.canonical_building_id);r.then(function(n){var t=n.cached;l[i.building_snapshot_id]?t=!0:(l[i.building_snapshot_id]=n.building,d(n.building,i)),e(l[i.building_snapshot_id],t)})}};var g=function(){for(var i in n.buildings){var e=n.buildings[i];l[e.id]&&(n.buildings[i]=l[e.id])}};n.sitePopupIsOpen=function(i){return n.map.hasLayer(i.marker.getPopup())};var p=function(){M()},d=function(){},f=function(i){var e=i.target.site;n.withDynamicBuilding(e,function(i){r.onSiteClick(i,e),n.updateBuildingHighlight(i),y(i,e)})},m=function(i){var e=i.target.site;n.withDynamicBuilding(e,function(i){r.onSiteMouseOver(i,e),n.updateBuildingHighlight(i),y(i,e)})},h=function(i){var e=i.target.site;n.withDynamicBuilding(e,function(i){r.onSiteMouseOut(i,e),n.updateBuildingHighlight(i),y(i,e)})},v=function(i){if(i.latlng={lat:parseFloat(i.latitude),lng:parseFloat(i.longitude)},!i.marker){var e=L.marker(i.latlng,{icon:r.markerIcon});e.site=i,i.marker=e,i.marker.on("click",f),i.marker.on("mouseover",m),i.marker.on("mouseout",h)}return n.siteLayer.hasLayer(i.marker)||n.siteLayer.addLayer(i.marker),i},b=function(i,n){var t=L.popup({autoPan:!1,minWidth:400,maxWidth:400,closeButton:!1}).setContent(e(r.popupHTML(i)));t.site=n,t.marker=n.marker,n.marker.bindPopup(t,{openOnClick:!1})},k=function(){a.forEach(function(i){i()}),a=[]},y=_.debounce(function(i){n.$apply(function(){B(i)})},100),B=function(i,e){e||(e=n.getSite(i)),r.onBuildingChange(i,e)},M=function(){k();for(var i in n.buildings)if(building=n.buildings[i],site=n.getSite(building),site){var e=n.$watch("buildings["+i+"]",B,!0);a.push(e)}};n.$watch("buildings",function(){n.updateBuildings()});var x=function(i,e){n.withDynamicBuilding(i,function(n){i.marker.getPopup()||b(n,i);var t=i.marker.openPopup();"function"==typeof e&&e(t)})},w=function(){n.map.closePopup()},A=function(i){n.sitePopupIsOpen(i)?w():x(i)};n.updateBuildingHighlight=function(i){site=n.getSite(i);var e=r.buildingHighlight(i,site);site&&site.marker&&site.marker._map&&(e?(site.marker.setIcon(r.markerIconActive),site.marker.setZIndexOffset(250),site._highlighted=!0):(site.marker.setIcon(r.markerIcon),site.marker.setZIndexOffset(0),site._highlighted=!1))},n.updateAllBuildingsHighlight=function(i){for(var e in n.buildings)i=n.buildings[e],n.updateBuildingHighlight(i)},n.pruneMarkers=function(){var i=n.siteLayer.getLayers();for(var e in i){var t=i[e];t.site||n.siteLayer.removeLayer(t)}},n.updateBuildings=function(){var i,e,t,o,r=n.getSites(),a={};g();for(i in r)a[r[i].building_snapshot_id]=r[i];for(i in n.buildings)e=n.buildings[i],s(i,e);for(i in r)o=r[i],o.latitude&&(t=c(o),v(t));for(var u in n.sites)a[u]||n.siteLayer.removeLayer(n.sites[u].marker);for(i in n.buildings)e=n.buildings[i],t=n.getSite(e),t&&d(e,t);p()},r.loadAPI({openPopup:x,closePopup:w,togglePopup:A,getBuilding:n.getBuilding,getSite:n.getSite,sitePopupIsOpen:n.sitePopupIsOpen,updateBuilding:B,updateBuildings:n.updateBuildings,updateBuildingHighlight:n.updateBuildingHighlight,updateAllBuildingsHighlight:n.updateAllBuildingsHighlight,withDynamicBuilding:n.withDynamicBuilding,centerOnMap:function(i,e){n.siteLayer.zoomToShowLayer(i.marker,e)},pruneMarkers:n.pruneMarkers})}])}(angular),function(i){var e=function(i,e){var n,t,o=i.getSize();return n=e.x<=o.x/3?"left":e.x<=2*o.x/3?"center":"right",t=e.y<=o.y/2?"top":"bottom",n+" "+t},n=function(i,n){var t=i.latLngToContainerPoint(n.marker.getLatLng());$(n._container).removeClass("top bottom left right center").addClass(e(i,t)+" has_value")};i.module("BE.frontend.buildingMap").directive("buildingMap",[function(){return{restrict:"A",scope:{buildings:"=buildings",getSites:"&buildingSites",getConfig:"&config",tileset:"@",initialCenter:"&",initialZoom:"&"},controller:"BuildingMapController",link:function(i,e){var t=i.config,o=i.createMap(e[0]),r=_.debounce(function(i,e){if(e.getLayers().length>0){var n=e.getBounds();i.fitBounds(n,{padding:[20,20]})}else i.setView([40,-95],4)},300);i.map=o,i.siteLayer=new L.MarkerClusterGroup({spiderfyDistanceMultiplier:2,maxClusterRadius:function(i){return 15>=i?60:16>=i?20:2}}),o.addLayer(i.siteLayer),i.controlLayer=L.control.layers([],{Buildings:i.siteLayer}).addTo(o),o.on("load",function(){r(o,i.siteLayer),o.on("zoomend dragend resize",_.debounce(function(){t.onViewportChange(o)},100)),t.initialize&&t.initialize(o,i.controlLayer)}),o.on("popupopen",function(i){n(o,i.popup),$(i.popup._container).find(".close_it").one("click",function(){o.closePopup()}),i.popup.site.popupIsOpen=!0}),o.on("popupclose",function(i){i.popup.site.popupIsOpen=!1}),i.initialCenter()&&i.initialZoom()?o.setView(i.initialCenter(),i.initialZoom()):r(o,i.siteLayer);var a=function(i){return i._leaflet_id},u=function(){var e=i.map.getZoom(),n=[],t=i.siteLayer.getLayers();for(var o in t){var r=t[o],u=r.site;u._highlighted&&n.push(r.__parent)}n=_.uniq(n,a);for(var l in n)for(var s=n[l];s.__parent&&s._zoom>=e;)s._icon&&$(s._icon).addClass("marker-cluster-highlighted"),s=s.__parent};i.siteLayer.on("animationend",function(){u(),i.updateAllBuildingsHighlight()})}}}])}(angular);
//# sourceMappingURL=be-frontend-components.min.js.map